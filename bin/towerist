#!/usr/bin/env ruby
# encoding: utf-8

require 'rubygems'
require 'nokogiri'
require 'byebug'
require 'cseg'

data_source = File.expand_path 'data/source/tower.html', Dir.pwd
reject_reg  = /(^\s*\d+$)|[：、？，！。的]|年\d+月|\d+日/

abort '数据源不存在' unless File.exists?(data_source)

# Fetch html data
html = File.open data_source
doc  = Nokogiri::HTML(html)
html.close

# Parse comments
comments = doc.xpath("//div[@class='comment-content editor-style']")
abort '数据源中不存在数据' if comments.empty?

# Segment
word_list = Hash.new(0)
comments.each do |comment|
  words = Kurumi.segment(comment.text.chomp.strip)
                .reject { |word| word =~ reject_reg }
                .compact

  words.each { |word| word_list[word] += 1 unless word =~ /^\s+$/ }
end

p word_list.sort_by { |_, count| count }.reverse[2]
